# 要件定義書

## 1. 概要

本ドキュメントは、リアルタイム音声コミュニケーション機能を持つWebアプリケーションの要件を定義する。
ユーザーは「ルーム」と呼ばれる仮想空間に参加し、音声の録音・再生を通じて他の参加者とインタラクションを行うことができる。アプリケーションにはゲームの要素が含まれ、参加者全員で状態を共有しながら進行する。

## 2. プロジェクトの目的

- ユーザーがオンライン上で気軽に音声を使ったコミュニケーションを楽しめるプラットフォームを提供する。
- Webソケット技術と最新のフロントエンド技術（Next.js）を活用し、低遅延でインタラクティブな体験を実現する。
- 多言語対応を行い、グローバルな利用を視野に入れる。

## 3. スコープ

### 3.1. 対象範囲

- **ルーム機能**:
    - ユーザーは指定されたURL（`/room/[roomId]`）を通じて特定のルームに参加できる。
    - 複数人が同時に同じルームに参加できる。
- **音声通信機能**:
    - ユーザーはマイクを使用して音声を録音できる (`AudioRecorder.tsx`)。
    - 録音された音声はサーバーへ送信される。
    - ルーム内の他の参加者が発した音声を再生できる (`AudioPlayer.tsx`)。
- **ゲーム機能**:
    - ルーム単位でゲームの状態を管理・同期する (`gameStore.ts`)。
    - ゲームに関連するデータ構造を定義する (`types/game.ts`)。
- **リアルタイム通信**:
    - WebSocket (`socket/client.ts`, `hooks/useSocket.ts`) を使用して、クライアントとサーバー間の双方向通信を実現する。
- **多言語対応**:
    - UIの表示言語を切り替える機能を提供する (`LanguageSwitcher.tsx`, `localeStore.ts`)。

### 3.2. 対象外範囲

- ユーザー認証機能（ログイン、アカウント作成）。
- ルームの永続的なデータ保存（チャットログや過去のゲーム結果の保存など）。
- 決済機能。
- 管理者向けのダッシュボード機能。

## 4. 機能要件

### 4.1. ルーム画面 (`/room/[roomId]`)

- **要件ID**: FR-001
- **要件**: ユーザーはルームIDを含むURLにアクセスすることで、該当のルーム画面を表示できる。
- **詳細**:
    - 画面には音声の録音・再生を行うためのUIが表示される。
    - 現在のルームに参加している他のユーザーの情報（アイコンや名前など）が表示されるエリアを持つ（将来的な拡張）。
    - ゲームの現在の状態やスコアが表示される。

### 4.2. 音声録音機能

- **要件ID**: FR-002
- **要件**: ユーザーは「録音開始」ボタンをクリックすることで、マイクからの音声入力を開始できる。
- **詳細**:
    - `useMediaRecorder`フックを利用して録音処理を制御する。
    - 録音中は、ユーザーに録音中であることが視覚的にわかるようにUIが変化する。
    - 「録音停止」ボタンをクリックすると録音が終了し、音声データが生成される。
    - 生成された音声データはWebSocketを通じてサーバーに送信される。

### 4.3. 音声再生機能

- **要件ID**: FR-003
- **要件**: サーバーから受信した音声データを自動または手動で再生できる。
- **詳細**:
    - `AudioPlayer.tsx`コンポーネントが音声データの再生を担う。
    - 複数の音声が同時に再生される場合も適切に処理する。

### 4.4. ゲーム状態の同期

- **要件ID**: FR-004
- **要件**: WebSocketを通じてサーバーから送信されるゲームの状態をリアルタイムにUIに反映する。
- **詳細**:
    - `gameStore.ts` (Zustandストア) を使用して、グローバルなゲーム状態を管理する。
    - サーバーからのイベント受信時にストアの状態を更新し、関連するUIコンポーネントが再レンダリングされる。

### 4.5. 言語切り替え機能

- **要件ID**: FR-005
- **要件**: ユーザーはUI上の言語スイッチャーを操作して、表示言語を切り替えることができる。
- **詳細**:
    - `localeStore.ts` (Zustandストア) で現在の言語設定を管理する。
    - `lib/translations.ts` に定義された翻訳テキストを基に、UIの文言が動的に変更される。

## 5. 非機能要件

### 5.1. パフォーマンス

- **要件ID**: NFR-001
- **要件**: 音声データの送受信における遅延を最小限に抑え、リアルタイムに近いコミュニケーションを実現する。WebSocketの通信は常時安定していること。

### 5.2. ユーザビリティ

- **要件ID**: NFR-002
- **要件**: ユーザーは直感的な操作で音声の録音・再生ができること。現在の通信状況や録音状態が分かりやすく表示されること。

### 5.3. 互換性

- **要件ID**: NFR-003
- **要件**: 最新版の主要なWebブラウザ（Google Chrome, Firefox, Safari）で正常に動作すること。

### 5.4. セキュリティ

- **要件ID**: NFR-004
- **要件**: WebSocket通信において、意図しない第三者からの接続やデータの盗聴を防ぐための基本的な対策を講じること (例: wssの利用)。

## 6. 技術スタック

- **フロントエンド**: Next.js (App Router), React, TypeScript
- **スタイリング**: Tailwind CSS
- **リアルタイム通信**: WebSocket (Socket.IOまたはそれに準ずるライブラリ)
- **状態管理**: Zustand
- **ビルド・開発環境**: Node.js

## 7. 成果物

- 本要件定義書に記載された機能を持つWebアプリケーションのソースコード一式。
- `README.md`（開発環境のセットアップ方法、実行方法を記載）。
