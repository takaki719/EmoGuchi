# 🛠️ EMOGUCHI 技術スタック設計（保存なし構成）

## 🎯 コンセプト

本ゲーム「エモグチ（EMOGUCHI）」は、**保存しない・軽量セッション制のリアルタイム音声パーティゲーム**です。  
そのため、永続的なDBや外部ストレージを使わず、**メモリとWebSocket中心の構成**とします。

---

## 🎨 フロントエンド

| 技術 | 用途 | 理由・備考 |
|------|------|------------|
| **TypeScript + React** | UI構築 | 型安全で保守しやすい。Socket.IOとの相性◎ |
| **Next.js（App Router）** | ページ遷移、構成管理 | デプロイしやすく、プロジェクト構成が整理しやすい |
| **Tailwind CSS** | スタイリング | 高速なスタイリングに適し、演出・アニメーションに強い |
| **Zustand** | グローバルステート管理 | 軽量でSocket連携にも向く。useStoreが直感的 |
| **Socket.IO Client** | WebSocket通信 | ルーム管理やラウンド進行、得点通知に使用 |

---

## 🧠 バックエンド（保存なし構成）

| 技術 | 用途 | 理由・備考 |
|------|------|------------|
| **FastAPI** | REST + WebSocketサーバー | 非同期、構造がシンプル、LLM連携にも適している |
| **Socket.IO（ASGI対応）** | WebSocketルーム管理 | クライアントとの互換性があり、ルームやブロードキャストも簡単 |
| **Uvicorn** | ASGIサーバー起動 | FastAPIと組み合わせて軽量に動作 |
| **Pydantic v2** | 型定義とバリデーション | イベントごとの安全なデータ送受信に使う |
| **OpenAI API** | セリフ生成 | 感情ラベルに応じたセリフを生成するためのLLM活用 |
| ❌ Redis / DB | 使用しない | すべてメモリ上（辞書）で一時管理するため不要 |

---

## 🗄️ インフラ・CI/CD

| 技術 | 用途 | 備考 |
|------|------|------|
| **Docker + Docker Compose** | ローカル開発環境の統一 | バックエンド・フロントエンドを一括で起動できる |
| **GitHub Actions** | CI/CDパイプライン | Lint / Build / Deploy などを自動化 |
| **Vercel** | フロントエンドホスティング | Next.jsに最適、設定が非常に簡単 |
| **Railway / Render / Fly.io** | バックエンドホスティング | FastAPI + WebSocket にも対応しやすい |

---

## 🎙️ 音声処理（クライアントサイド）

| 技術 | 用途 | 備考 |
|------|------|------|
| **MediaRecorder API** | 音声録音 | ブラウザでスピーカーの音声を取得 |
| **Web Audio API** | 音声再生・音量制御 | 投票フェーズ前の再生確認など |
| **ffmpeg.wasm**（任意） | フォーマット変換 | 音声のダウンロード・変換に必要な場合のみ利用 |

---

## 🧪 テスト・開発体験

| 技術 | 用途 | 備考 |
|------|------|------|
| **Vitest** | フロントエンドユニットテスト | React + Zustand のテストに対応 |
| **Playwright** | E2Eテスト | WebSocketやリアルタイムUIのテストに対応 |
| **Prettier + ESLint** | コード整形と構文チェック | チーム開発でもブレがなく、CIでも自動化可能 |
| （任意）Storybook | UIコンポーネントの開発 | UIが複雑になってきたら検討対象 |

---

## ✅ この構成の狙いと特徴

| 特徴 | 説明 |
|------|------|
| 🎯 **軽量＆高速** | データベース非依存、即時性を重視 |
| 🧠 **シンプルな状態管理** | すべてPythonのメモリ辞書で完結 |
| 🔌 **リアルタイム性重視** | WebSocketベースの進行に特化 |
| 🛠️ **拡張性確保** | 将来的なスコア保存や音声アップロードにも対応しやすい構成を意識済み |

---

## 🔮 将来的な拡張プラン（必要に応じて）

| 目的 | 追加技術 |
|------|-----------|
| スコア保存 | Supabase / PostgreSQL |
| 録音アップロード | Supabase Storage / AWS S3 |
| 再接続サポート | Redis などの共有メモリ |
| ゲーム履歴保存 | `flush_to_db()` 関数を組み込み可能にする構造設計 |

---
